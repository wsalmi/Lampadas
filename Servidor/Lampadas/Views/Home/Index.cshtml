@Html.Partial("_Home")
@section Scripts{
    <script src="~/Scripts/jquery.signalR-2.2.3.min.js"></script>
    <script src="@Url.Content("~/signalr/hubs")"></script>

    <script>
        var hubTest = $.connection.mainHub;
        var card = $('#TemplateCard').find('li#second-child').clone();

        hubTest.client.acender = function (lampada, seconds) {
            $('#lampada-' + lampada).addClass('lampada-on');
        }

        hubTest.client.apagar = function (lampada, seconds) {
            $('#lampada-' + lampada).removeClass('lampada-on');
        }

        hubTest.client.reiniciar = function () {
            // Apagar todos os cards!
        }

        $.connection.hub.stateChanged(function (s, e, c) {
            if (s.newState != 0)
                $.connection.hub.start();
        });

        $.connection.hub.start();

        $.getJSON('./api/lampada/status', (data) => {
            for (var i in data) {
                var lamapda = $('#lampada-' + data[i]['id-lampada']);

                if (data[i]['status'])
                    lamapda.addClass('lampada-on');
                else
                    lamapda.removeClass('lampada-on');
            }
        });
    </script>
}